#include "vector.h"
#include "readfile.h"


int parseLine(const String line) {
  if (line.length <= 0) return 0;

  const int sign = line.values[0] == 'L' ? -1 : 1;

  int val = 0;
  for (int i = 1; i < line.length; i++)
    val = 10 * val + (int)(line.values[i] - '0');

  return sign * val;
}


int updateDial(const int dial, const int offset) {
  const int result = (dial + offset) % 100;
  return result < 0 ? result + 100 : result;
}


int main(int argc, char* argv[]) {
  if (argc < 2) {
    printf("Need file argument!\n");
    return -1;
  }

  StringVector lines = readfile(argv[1]);

  int dial0 = 50;
  int counter_p1 = 0;
  int counter_p2 = 0;

  for (int i = 0; i < lines.length; i++) {
    String line = lines.values[i];
 
    const int offset = parseLine(line);
    const int dial1  = updateDial(dial0, offset);
    const int passes0 = (offset + dial) / 100;
    printf("dial: %3d, offset: %3d, %3d, passes0: %3d", dial, offset, passes0);
    counter_p1 += (dial = updateDial(dial, offset))==0;
    counter_p2 += passes0 < 0 ? -1 * passes0 : passes0;
    printf(", next(dial): %3d\n",dial); 
  }

  printf("Answer Task 1 = %d\n", counter_p1);
  printf("Answer Task 2 = %d\n", counter_p2);
  freeStringVector(&lines);
  
  return 0;
}
